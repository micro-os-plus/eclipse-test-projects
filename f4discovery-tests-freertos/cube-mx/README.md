# The CubeMX folder

This folder contains:

- the `Src` and `Inc` folders, with the code generated by CubeMX;
- the `cube-mx.ioc` file, with the CubeMX configuration.

## How to further edit the hardware configuration?

The hardware configuration can be changed at any moment during development.

- start CubeMX
- load `cube-mx/cube-mx.ioc`
- edit
- generate the code again.

## Changes

The following changes were required to adapt the code generated by CubeMX to the µOS++ project.

### main.c

- add the header to include the trace functions
```
/* USER CODE BEGIN Includes */
#include "cmsis-plus/diag/trace.h"
/* USER CODE END Includes */
```
- rename `main()` to `cube_mx_init()`, by use of a preprocessor definition
```
/* USER CODE BEGIN 0 */
int
cube_mx_init(void);

#define main cube_mx_init
/* USER CODE END 0 */
```
- make `main()` return
```
  /* USER CODE BEGIN 3 */
  return 0;
  /* USER CODE END 3 */
```

### stm32f4xx_it.c

- add an external definition to µOS++ system time handler
```
/* USER CODE BEGIN 0 */
extern void os_systick_handler (void);
/* USER CODE END 0 */
```
- call the µOS++ system time handler in `the SysTick_Handler()`
```
  /* USER CODE BEGIN SysTick_IRQn 1 */
  os_systick_handler ();
  /* USER CODE END SysTick_IRQn 1 */
```

## HAL versions

The HAL version used by CubeMX, configured in `cube-mx.ioc` is:

```
ProjectManager.FirmwarePackage=STM32Cube FW_F4 V1.12.0
```

When starting, CubeMX will check the HAL version used by the project and offer to update if a newer HAL was installed.

Since this project uses the warnings free HAL and CMSIS files from the xPacks and not those under CubeMX control, deny the offer to update.

To avoid surprises, the version used by CubeMX, configured in `cube-mx.ioc`
must match the version used by the stm32f4-cmsis & stm32f4-hal xPacks.

## Avoid unnecessary code

With all code provided by the xPacks, the HAL code managed by CubeMX is no longer needed. To avoid polluting the project with useless code, it is recommended to configure the CubeMX project to refer the HAL from its original location.

This translates into the following option in `cube-mx.ioc`:

```
ProjectManager.LibraryCopy=2
```
